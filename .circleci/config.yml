version: 2
jobs:
  build:
    working_directory: ~/dorm_elect
    docker:
      - image: debian:stretch
    steps:
      - run:
          name: Update Container
          command: apt-get update -y
      - run:
          name: Hotfix to container
          command: apt-get install -y ca-certificates curl sudo gnupg gnupg2 gnupg1
      - run:
          name: Install Required complier
          command: apt-get install -y uglifyjs zip unzip git software-properties-common
      - run:
          name: Install PHP 5.6
          command: |
            add-apt-repository ppa:ondrej/php
            apt-get update -y
            apt-get install -y php5.6 php5.6-mbstring php5.6-mcrypt php5.6-mysql php5.6-xml php5.6-cli php5.6-common php5.6-ldap php5.6-cli
      - run:
          name: Check PHP version
          command: php -v
      - checkout
      - run:
          name: Install NodeJS
          command: |
            curl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash -
            apt-get install -y nodejs
            apt-get install -y build-essential
      - run:
          name: Install composer
          command: |
            php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
            php -r "if (hash_file('SHA384', 'composer-setup.php') === '544e09ee996cdf60ece3804abc52599c22b1f40f4323403c44d44fdfdd586475ca9813a858088ffbc1f233e9b180f061') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;"
            php composer-setup.php
            php -r "unlink('composer-setup.php');"
      - run:
          name: composer
          command: |
            php composer.phar require --dev jakub-onderka/php-parallel-lint
            php composer.phar require --dev jakub-onderka/php-console-highlighter
      - run:
          name: Test Files
          command: ./vendor/bin/parallel-lint .
      - store_artifacts:
          path: /root/dorm_elect